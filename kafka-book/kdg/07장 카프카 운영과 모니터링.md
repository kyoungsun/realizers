# 카프카 운영과 모니터링

<hr>

- 카프카 모니터링이라고 해서 단순히 카프카만 모니터링 하는게 아니라 카프카가 실행되고 있는 하드웨어의 리소스도 함께 모니터링해야 합니다.

<br>

## 안정적인 운영을 위한 주키퍼와 카프카 구성

#### 주키퍼 구성

- 주키퍼는 기본적으로 과반수 구성을 기반으로 동작하므로 반드시 홀수로 구성해야 합니다.
  - 주키퍼 구성 시 최소 수량으로 주키퍼를 구성한다면 주키퍼 서버의 수는 3개입니다.

#### 주키퍼 하드웨어

- 물리적인 메모리 크기는 4~8GB로 설정하고, 디스크는 240G 또는 480G SSD를 사용하는 것을 추천한다고 합니다.
- 주키퍼에서 필요로하는 heap 메모리 크기는 일반적으로 1~2GB이며, 나머지는 OS 영역에서 사용됩니다.

#### 카프카 구성

- 카프카는 주키퍼와 다르게 쿼럼(과반수) 방식의 구성이 필요하지 않습니다.
- 최소 수량 카프카를 구성한다면 짝수인 2대도 가능하지만 카프카에서 추천하는 replication-factor 수는 3이므로 최소 3대의 브로커가 필요합니다.

#### 카프카 하드웨어

- 주키퍼와 달리 카프카는 CPU 사용률이 높습니다.
- producer나 consumer의 처리량을 높이기 위해서 배치 전송과 압축 기능을 사용하는데, 이에 따라 CPU 자원을 많이 소모하게 됩니다. 그렇다고 해서 최신의 고성능 CPU만 고집할 필요는 없고 코어 수가 많은 CPU로 구성할 것을 권장합니다.
- 메모리는 32GB부터 256GB까지 다양하게 선택할 수 있지만 카프카에서 요구하는 JVM heap memory 크키는 일반적으로 6GB 정도이므로 이보다 큰 물리 메모리를 필요로 합니다.
- 카프카에서 heap memory를 제외한 나머지 물리 메모리는 모두 페이지 캐시로 사용됩니다.

#### 💡 Kafka 구동시 설정한 heap memory를 초과하면?

- 설정한 heap memory를 초과하는 경우 프로그램이 중지되지 않도록 데이터를 swap 공간으로 복사하게 됩니다. 이는 성능 저하를 유발시킨다
- 카프카 성능을 최대로 늘리고싶다면 vm.swappiness 설정을 0으로 하여, 메모리에서만 처리하도록 해야합니다.

<br>

## 모니터링

- 돈이 많다면 Confluent Control Center가 좋아 보입니다.
- https://devocean.sk.com/blog/techBoardDetail.do?ID=163980



