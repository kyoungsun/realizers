11장 단위 테스트 안티 패

비공개 메서드와 테스트 취약성

- 비공개 메서트를 노출하면 테스트가 구현 세부 사항과 결합되고 결과적으로 리팩터링 내성이 떨어진다.
- 비공개 메서드를 직접 테스트 하는 대신, 포괄적인 식별할 수 있는 동작으로 간적적인 테스트를 해라.
- 비공개 메서드가 너무 복잡하다면 추상화가 누락됐다는 뜻이다 추상화를 별도 클래스로 추출하자.

드물지만 비공개 메서드가 클래스의 식별할 수 있는 동작에 속한 경우가 있다. 보통 클래스와 ORM 또는 팩토리 간의 비공개 계약을 구현하는 것들이 해당 된다.

비공개 였던 상태를 단위 테스트만으르 위해 노출하지 말자. 테스트는 제품 코드와 같은 방식으로 테스트 대상 시스템과 상호 작용해야 한다. 어떠한 특권도 가져서는 안된다.

테스트를 작성할 때 특정 구현을 암시하지 말자. 블랙박스 관점에서 제품 코드를 검증하고 도메인 지식을 테스트에 유출하지 않도록 해야한다.

코드 오염은 테스트엠나 필요한 제품 코드를 추가하는 경우다 테스트 코드와 제품코드가 혼재되게 하고 제품 코드의 유지비를 증가시키기 때문에 안티패턴이다.

기능을 지키려고 구체 클래스를 목으로 처리해야 하면, 이는 단일책임원칙을 위반하는 결과다. 해당 클래스를 두가지 클래스 도메인 로직이 있는 클래스와 프로세스 외부 의존성과 통신하는 클래스로 분리하자.

현재 시간을 앰비언트 컨택스트로 하면 제품 코드가 오염되고 테스트하기가 더 어려워진다. 서비스난 일반 값의 명시적인 의존성으로 시간을 주입하자. 가능하면 항상 일반값이 좋다.