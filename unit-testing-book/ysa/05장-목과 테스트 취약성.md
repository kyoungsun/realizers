# 05장-목과 테스트 취약성

## 5.1 목과 스텁 구분

### 5.1.1 테스트 대역 유형

1. 목(목, 스파이) : 외부로 나가는 상호작용 모방하고 검사
    - 이메일 발송을 위한 SMTP 서버는 목 (사이드 이펙트 가능)
2. 스텁(스텁,더미,페이크) : 내부로 들어오는 상호작용 모방
- 목은 SUT와 관련 의존성 간의 상호 작용을 모방하고 검사
- 스텁은 모방만 한다. 테스트 진행 X

### 5.1.2 도구로서의 목, 테스트 대역으로서의 목

- 목라이브러리를 사용하는것 : 도구

### 5.1.3 스텁으로 상호 작용을 검증하지 말것

- 테스트는 최종 결과만 검증해야한다. 스텁은 최종결과가 아니다.
- 최종결과가 아닌 사항을 검증하는 것을 과잉 명세라고 한다.

### 5.1.4 목과 스텁 함께 쓰기

- 테스트 대역을 목과 스텁 둘중에 하나로만 나눠야하는 것은 아니다.
- 테스트 대역이 목과 스텁의 특성을 모두 나타내는 경우도 충분히 가능하다
- 명심해야할 점은 스텁과의 상호작용은 검증하면 안된다.

### 5.1.5 목과 스텁은 명령과 조회에 어떻게 관련돼 있는가.

- 명령 : 사이드 이펙트 초래, 반환값 없음, 테스트 대역(목)
- 조회 : 사이드 이펙트 없음, 반환값 있음, 테스트 대역(스텁)

## 5.2 식별할 수 있는 동작과 구현 세부 사항

- 제품 코드는 공개 API(public) 또는 비공개 API(private)로 구분된다.
- 식별할 수 있는 동작 또는 구현 세부 사항
- 식별할 수 있는 동작 = 공개 API
    - 클라이언트의 목표를 달성하는데 도움이 되는 연산 노출
    - 클라이언트의 목표를 달성하는데 도움이 되는 상태 노출
- 식별할 수 있는 동작이 아니면 공개 API로 설정하지 말것
- 구현 세부 사항을 알지 못하도록 캡슐화를 해야한다.

## 5.3 목과 테스트 취약성

### 5.3.1 육각형 아키텍처 정의

- 도메인 계층과 애플리케이션 서비스 계층간의 관심사 분리
    - 도메인 계층 : 비즈니스 로직을 책임
    - 서비스 계층 : 외부 애플리케이션과의 통신 및 데이터 검색
- 애플리케이션 내부 통신
    - 서비스 계층에서 도메인 계층으로 단방향 의존성을 가져야한다.
    - 도메인 계층은 서비스 계층을 의존하지 않는다.
- 애플리케이션간의 통신
    - 서비스 계층을 통해 연결
- 애플리케이션 서비스 테스트 : 비즈니스 유스케이스가 어떻게 실행되는지 확인
- 도메인 클래스 테스트 : 유스케이스 완료를 위한 중간의 하위목표 검증
- 공개 API를 항상 비즈니스 요구 사항에 따라 추적할 것

### 5.3.2 시스템 내부 통신과 시스템 간 통신

- 시스템 내부 통신 : 애플리케이션 내 클래스 간 통신
- 시스템 간 통신 : 다른 애플리케이션과의 통신

### 5.3.3. 시스템 내부 통신과 시스템 간 통신의 예

```
비즈니스 유스케이스 예시
- 고객이 상점에서 제품을 구매하려고 한다
- 매장 내 제품 수량이 충분하면
   1. 재고가 상점에서 줄어든다.
   2. 고객에게 이메일로 영수증을 발송한다.
   3. 확인내역을 반환한다.
```

- 구매에 성공했는지 검증
- 구매에 대한 영수증을 이메일로 보내는지 검증
- 재고가 줄어들었는지는 검증하지 않음 (재고가 줄어드는것은 목표로 가는 구현 세부사항이다)

## 5.4 고전파와 런던파 재고

- 시스템 내 통신 검증 : 목을 사용하지 않고 스텁을 사용한다.
- 시스템 간 통신과 해당 통신의 사이드 이펙트가 외부환경에서 보일때만 목을 사용한다.