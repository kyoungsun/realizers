# 09장 목 처리에 대한 모범 사례

- 목은 테스트 대상 시스템과 의존성 간의 상호 작용을 모방하고 검사하는데 도움되는 테스트 대역
- 목은 비관리 의존성에서만 적용되야한다.

## 9.1 목의 가치를 극대화 하기

### 9.1.1 시스템 끝에서 상호 작용 검증하기

- 시스템 끝에서 비관리 의존성과 상호작용을 검증하라
- 비관리 의존성과 통신하는 마지막 타입을 목으로 처리하면 통합 테스트가 거치는 클래스의 수가 증가하므로 보호가 향상된다.
- Tip : 비관리 의존성에 대한 호출은 애플리케이션을 떠나기 전에 몇 단계를 거친다. 마지막 단계를 목으로 선택하라.

### 9.1.2 목을 스파이로 대체하기

- 스파이는 수동으로 작성하여 목의 역할을 함

## 9.2 목 처리에 대한 모범 사례

### 9.2.1 목은 통합 테스트만을 위한 것

- 단위 테스트에 목을 사용 하면 안도딘다.

### 9.2.2 테스트당 목이 하나일 필요는 없음

- 목이 둘 이상인 경우에는 여러가지를 테스트 할 가능성이 있다.
- **동작 단위**를 검증하는데 필요한 목의 수는 관계가 없다
- 목의 수는 운영에 참여하는 비관리 의존성의 수에만 의존한다.

### 9.2.3 호출 횟수 검증하기

- 예상하는 호출이 있는가
- 예상치 못한 호출은 없는가
- 예상하는 호출이 한번만 있는지 꼭 확인 해야한다.

### 9.2.4 보유 타입만 목으로 처리하기

- 서드파티 라이브러리 위에 항상 어댑터를 작성하고 기본 타입 대신 해당 어댑터를 목으로 처리해야한다.
    - 기본 라이브러리의 복잡성을 추상화
    - 라이브러리에서 필요한 기능만 노출
    - 프로젝트 도메인 언어를 사용해 수행 가능
- 비관리 의존성 이외에 다른 용도는 목으로 노력을 들일 가치가 없다.