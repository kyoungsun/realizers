# 통합 테스트를 하는 이유
<hr>

- 단위 테스트가 비지니스 로직을 확인하는데 좋지만 이에만 의존하면 시스템이 전체적으로 잘 작동하는지 확신할 수 없다.
그렇기 때문에 비지니스 로직이 외부 프로세스와 잘 연동되는지 확인하기 위해서는 통합테스트를 해야한다.

<br>

### 통합 테스트는 무엇인가?
<hr>

- 시스템이 외부 프로세스와 통합해 어떻게 작동하는지 검증하는 것
- 통합 테스트는 애플리케이션 코드와 수 많은 라이브러리, 외부 프로세스를 거치므로 회귀 방지가 뛰어나디.
- 단위 테스트로 가능한 한 많은 비지니스 시나리오 예외 상황을 확인하고, 통합 테스트는 주요 흐름과 단위 테스트가 다루지 못하는 예외 상황을 다룬다.

<br>

### 어떤 외부 프로세스를 직접 테스트해야 하는가?
<hr>

#### 💡프로세스 외부 의존성의 두 가지 유형

- 관리 의존성
  - 관리 의존성은 애플리케이션을 통해서만 접근할 수 있으며, 해당 의존성과의 상호작용은 외부 환경에서 볼 수 없다.(데이터베이스)
  - 관리 의존성과의 통신은 구현 세부 사항이다.
- 비관리 의존성
  - 해당 의존성과의 상호작용을 외부에서 볼 수 있다.(SMTP 서버와 메시지 버스)
  - 비관리 의존성과의 통신은 시스템이 식별할 수 있는 동작이다.

<br>

### 의존성 추상화를 위한 인터페이스 사용
<hr>

#### 💡인터페이스와 느슨한 결합

- 인터페이스를 사용하는 일반적인 이유
  - 프로세스 외부 의존성을 추상화해 느슨한 결합 달성
  - 기존 코드를 변경하지 않고 새로운 기능을 추가하는 OCP 원칙 달성

- 위에서 두번째 이유는 YAGNI(오버엔지니어링 하지말라는 원칙) 원칙을 위반하기 때문에 잘못된 생각이다.

<br>

#### 💡프로세스 외부 의존성에 인터페이스를 사용하는 이유는 무엇인가?

- 각 인터페이스에 구현이 하나만 있다고 가정할 때 외부 의존성에 인터페이스를 사용하는 이유는 목을 사용하기 위함이라 한다.
- 인터페이스가 없으면 Test Double을 만들 수 없으므로 데스트 대상 시스템과 프로세스 외부 의존성 간의 상호 작용을 확인할 수 없다.
- 따라서 이러한 의존성을 목으로 처리할 필요가 없는 한 외부 의존성에 대한 인터페이스를 두지 말라.

<br>

#### 🤔 나는 생각이 다르다.

- Test Double로 사용하지 않더라도 프로세스 외부 의존성에는 항상 인터페이스를 둬야한다.
   - 이유 1. 고수준은 저수준에 의존하면 안된다. 고수준과 저수준 모두 추상화애 의존해야 한다. (DIP 원칙 준수)
   - 이유 2. 인터페이스를 둠으로써 서비스 계층이 비대해지는것을 방지할 수 있다.
   - 이유 3. 중복 방지를 달성할 수 있다.

<br>

### 로깅 테스트
<hr>

- 로깅이 식별할 수 있는 동작이라면 테스트를 하고 아니라면 테스트가 필요없다.

<br>

### 공유 해보면 좋을 의견들
<hr>

1. 통합 테스트가 제품 코드와 결합도가 낮아서 리팩토링 내성이 우수하다는데 무슨 의미안가?
    - 오히려 제품 코드와 결합도가 높은거 아닌가라는 생각이 듬
2. fail fast, fail safe는 각각 어떤 상황에 사용할 적용할 수 있을까?
    - fail fast
      - 오류 발견 즉시 이를 노출하고 시스템을 중단시킨다.
      - 아이 유효성 검증 등
    - fail safe
      - 오류를 발생해도 작업을 중단하지 않고 계속 수행한다.
      - ???
3. 메시지 버스도 관리 의존성이 아닌가?
   - 외부 클라이언트가 메시지 버스 구현이 Kafka인지 RabbitMQ인지 알필요가 없고, 어떻게 구성하는지 알필요가 없을텐데 왜 비관리 의존성인가
4. 통합 테스트에서 실제 데이터베이스를 사용하는게 아닌 테스트 DB를 사용하는거 아닌가?
5. 인터페이스에 구현이 하나만 있다고 가정할 때 프로세스 외부 의존성에 인터페이스를 사용하는 이유가 Test Double을 위한 것이고 Test Double을 할 필요가 없다면 YAGNI 원칙에 위배된다고 하는데 어떻게 생각하는가?
   - Test Double을 위한 것이 아니더라도 인터페이스를 두는게 맞다고 생각함
     - 이유 1. 고수준은 저수준에 의존하면 안된다. 고수준과 저수준 모두 추상화애 의존해야 한다. (DIP 원칙 준수)
     - 이유 2. 인터페이스를 둠으로써 서비스 계층이 비대해지는것을 방지할 수 있다.
     - 이유 3. 중복 방지를 달성할 수 있다.
